<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Food Truck Finder</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
    <h1>Welcome to Awesome Food Truck Finder</h1>
    <p>Enter the IP address to find nearby food trucks, or leave it blank to use your current IP address.</p>

    <form id="food-truck-form">
        {% csrf_token %}
        <label for="ip_address">IP Address:</label>
        <input type="text" id="ip_address" name="ip_address" placeholder="Enter IP Address (default: Your IP Address)">

        <label for="number_of_trucks">Number of Trucks:</label>
        <input type="number" id="number_of_trucks" name="number_of_trucks" value="5">

        <button type="submit"> Find Food Trucks</button>
    </form>

    <div id="response"></div>

    <script>
        $(document).ready(function() {
            $('#food-truck-form').submit(function(event) {
                event.preventDefault(); // Prevent the form from submitting via the browser a.k.a. don't reload the page

                let ip_address = $('#ip_address').val();
                let number_of_trucks = $('#number_of_trucks').val();

                let url = `{% url 'nearby-food-trucks' %}`; // URL of your API endpoint

                {#console.log('IP Address: ' + ip_address);#}
                {#console.log('URL: ' + url);#}

                $.ajax({
                    url: url,
                    type: 'GET',
                    data: {
                        ip_address: ip_address,
                        number_of_trucks: number_of_trucks
                    },
                    success: function(data) {
                        // Handle the response - update the page
                        if (data.length === 0) {
                            $('#response').html('No food trucks found. Check your IP address and try again.');
                        } else {
                            $('#response').html(''); // Clear previous response
                            $.each(data, function(i, truck) {
                                $('#response').append('<p>' + truck.name + '</p>');
                            });
                        }
                    },
                    error: function(xhr, status, error) {
                        $('#response').html('Error: ' + error);
                    }
                });
            });
        });
    </script>

</body>
</html>